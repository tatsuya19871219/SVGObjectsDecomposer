<!-- Copyright (c) Microsoft Corporation and Contributors. -->
<!-- Licensed under the MIT License. -->

<Window
    x:Class="SVGObjectsDecomposer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SVGObjectsDecomposer"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:svg="using:Svg"
    xmlns:brushes="using:CommunityToolkit.WinUI.UI.Media"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Vertical"
                            Grid.Column="0">

                    <Grid BorderBrush="Black" BorderThickness="2"
                          AllowDrop="True"
                          DragOver="App_DragOver"
                          Drop="App_Drop"
                          Margin="40"
                          Height="350">

                        <Grid.Background>
                            <brushes:TilesBrush TextureUri="/Assets/TileBase.png"/>
                        </Grid.Background>

                        <TextBlock x:Name="DragDropMessage" 
                               Text="Drop a SVG file here."
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Visibility="{x:Bind AppState.IsInitialized, Mode=OneWay}"/>

                        <Image x:Name="OriginalSVGImage" Opacity="0.5"/>

                        <Image x:Name="SelectedSVGObject"/>

                        <!--
                        x:Bind default mode is one time
                            https://stackoverflow.com/questions/72034501/binding-not-updating-winui-3
                        -->
                        <!--<ToggleSwitch IsOn="{x:Bind Path=AppState.IsSVGLoaded, Mode=OneWay}"/>-->

                    </Grid>

                    <Viewbox x:Name="SVGImageInfo" 
                             Height="100">
                        <TextBlock Text="AAAAAAAAA"/>
                    </Viewbox>

                </StackPanel>

                <Grid Grid.Column="1">
                    
                    <Grid.Resources>
                        <CollectionViewSource x:Name="GroupedSVGObjects" IsSourceGrouped="True"/>
                    </Grid.Resources>
                    

                    <GridView x:Name="DecomposedImages"
                              BorderThickness="1"
                              BorderBrush="Black"
                              ItemsSource="{Binding Source={StaticResource GroupedSVGObjects}}"
                              Margin="30"
                              SelectionChanged="DecomposedImages_SelectionChanged">

                        <GridView.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate>

                                        <TextBlock Text="{Binding Key}"/>

                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                            </GroupStyle>
                        </GridView.GroupStyle>

                        <GridView.ItemTemplate>
                            
                            <DataTemplate x:DataType="local:SVGObject">
                                <Grid Height="150">

                                    <Grid.Background>
                                        <brushes:TilesBrush TextureUri="/Assets/TileBase.png"/>
                                    </Grid.Background>

                                    <Image Source="{x:Bind local:ValueConverterHelper.ConvertToBitmapImage(Image)}"/>
                                    <TextBlock Text="{x:Bind LayerID}"/>
                                    <ToggleButton Content="Trim" 
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"/>

                                </Grid>
                            </DataTemplate>

                            <!-- <DataTemplate x:DataType="ImageSource">
                                <Grid Height="150">
                                    <Image Source="{x:Bind}"/>
                                </Grid>
                            </DataTemplate> -->
                            
                        </GridView.ItemTemplate>
                    </GridView>
                    
                </Grid>
                
            </Grid>
            
        </Grid>

        <Grid Grid.Row="1">

            <StackPanel BorderBrush="Black" BorderThickness="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="30" Spacing="30">

                <StackPanel.Resources>
                    <Style TargetType="Button">
                        <Setter Property="FontSize" Value="24"/>
                        <Setter Property="Margin" Value="20"/>
                    </Style>
                </StackPanel.Resources>
                
                <Button Content="Open a SVG file" Click="OpenFileButton_Click"/>
                <!--<Button Content="Trim parts"/>-->
                <Button Content="Save SVG parts"/>
                <Button Content="Close the SVG file" Click="CloseFileButton_Click"/>
            </StackPanel>
        </Grid>
        
    </Grid>
</Window>
